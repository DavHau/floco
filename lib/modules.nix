# ============================================================================ #
#
#
#
# ---------------------------------------------------------------------------- #

{ lib }: let

# ---------------------------------------------------------------------------- #

in {

# ---------------------------------------------------------------------------- #

  moduleDropDefaults = submodule: value: let
    subs = submodule.getSubOptions [];
  in lib.filterAttrs ( f: v:
    ( ! ( subs.${f} ? default ) ) || ( v != subs.${f}.default )
  ) value;


# ---------------------------------------------------------------------------- #

  moduleHandleJSONPath = x: let
    isPathlike = ( builtins.path x ) ||
                 ( ( builtins.isAttrs x ) && ( x ? outPath ) ) ||
                 ( ( builtins.isString x ) && ( lib.test "/.*" x ) );
    isJSON = lib.hasSuffix ".json" ( toString x );
  in if ! ( isPathlike && isJSON ) then x else lib.modules.importJSON x;


# ---------------------------------------------------------------------------- #

}


# ---------------------------------------------------------------------------- #
#
#
#
# ============================================================================ #
